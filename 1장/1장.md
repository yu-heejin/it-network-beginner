# 1.1 네트워크 구성도 살펴보기
## 1.1.2 데이터 센터 네트워크

- 데이터 센터 네트워크는 안정적이고 빠른 대용량 서비스 제공을 목표로 구성한다.
- 안정적인 서비스 제공을 위해 다양한 이중화 기술을 사용해야 하고 많은 서버와 서비스가 한 네트워크에 연결되어 있으므로 높은 통신량을 수용할 수 있어야 한다.
    - 이러한 조건을 만족하기 위해 10G, 25G, 40G 등과 같은 고속 이더넷 기술이 사용된다.
- 이러한 데이터 센터 구성은 기존에는 3계층 구성이 일반적이었지만, **가상화 기술과 높은 대역폭을 요구하는 스케일 아웃(Scale-Out) 기반의 애플리케이션과 서비스가 등장하면서 2계층 구성인 스파인 리프(Spine-Leaf) 구조로 데이터 센터 네트워크가 변화되었다.**
    - Spine-Leaf 구조는 서버 간 통신이 늘어나는 최근 트래픽 경향을 지원하기 위해 제안되었다.
 
# 1.2 프로토콜
- 일반적으로 TCP/IP는 프로토콜이라 부르지 않고 프로토콜 스택이라고 부른다.
    - TCP와 IP는 별도 계층에서 동작하는 프로토콜이지만 함께 사용하고 있는데, 이러한 프로토콜 묶음을 프로토콜 스택이라고 부른다.
    - TCP/IP 프로토콜 스택에는 TCP와 IP뿐만 아니라 UDP, ICMP, HTTP와 같은 매우 다양한 애플리케이션 레이어 프로토콜들이 있다.
- TCP/IP 프로토콜 스택은 총 4개 부분으로 나뉜다.
    - 물리 부분인 `이더넷` 외에 데이터가 목적지를 찾아가도록 해주는 `네트워크 계층`
    - 잘린 패킷을 데이터 형태로 잘 조합하도록 도와주는 `전송 계층`
    - `애플리케이션 계층`
 
# 1.3 OSI 7계층과 TCP/IP
## 1.3.1 OSI 7계층

| 계층 | 데이터 |
| --- | --- |
| 애플리케이션 계층(Application) | Data |
| 프레젠테이션 계층(Presentation) | Data |
| 세션 계층(Session) | Data |
| 트랜스포트 계층(Transport) | Segments |
| 네트워크 계층(Network) | Packets |
| 데이터 링크 계층(Data Link) | Frames |
| 피지컬(물리) 계층(Physical) | Bits |
- 계층별로 프로토콜을 개발해 네트워크 구성 요소들을 모듈화할 수 있다.
- OSI 7계층은 다시 아래와 같은 두 계층으로 나뉠 수 있다.
    - 1-4 계층: 데이터 플로 계층(Data Flow Layer) / 하위 계층
    - 5-7 계층: 애플리케이션 계층(Application Layer) / 상위 계층

## 1.3.2 TCP/IP 프로토콜 스택

| 계층 | 데이터 | TCP/IP 모델 |
| --- | --- | --- |
| 애플리케이션 계층(Application) | Data | 애플리케이션 계층(Application) |
| 프레젠테이션 계층(Presentation) | Data | 애플리케이션 계층(Application) |
| 세션 계층(Session) | Data | 애플리케이션 계층(Application) |
| 트랜스포트 계층(Transport) | Segments | 트랜스포트 계층(Transport) |
| 네트워크 계층(Network) | Packets | 인터넷(Internet) |
| 데이터 링크 계층(Data Link) | Frames | 네트워크 액세스(Network Access) |
| 피지컬(물리) 계층(Physical) | Bits | 네트워크 액세스(Network Access) |

# 1.4 OSI 7계층별 이해하기

## 1.4.1 1계층(물리 계층)

- 물리적 연결과 관련된 정보를 정의한다.
- 주로 전기 신호를 전달하는 데 초점이 맞추어져 있다.
- 1계층의 주요 장비로는 허브(Hub), 리피터(Repeater), 케이블(Cable), 커넥터(Connector), 트랜시버(Tranceiver), 탭(TAP) 등이 있다.
    - 허브, 리피터는 네트워크 통신을 중재하는 네트워크 장비이다.
    - 케이블과 커넥터는 케이블 본체를 구성하는 요소이다.
    - 트랜시버는 컴퓨터의 랜카드와 케이블을 연결하는 장비이다.
    - 탭은 네트워크 모니터링과 패킷 분석을 위해 전기 신호를 다른 장비로 복제해준다.
- 1계층에서는 들어온 전기 신호를 그대로 잘 전달하는 것이 목적이므로 **전기 신호가 1계층 장비에 들어오면 이 전기 신호를 재생성해 내보낸다.**
    - 물리 계층에서는 입력된 전기 신호를 최대한 잘 전달하는 것이 주된 목표입니다. 신호가 물리 계층 장비에 들어오면, 이 장비는 신호를 재생성(리피트)하여 출력합니다. 이는 신호의 품질을 유지하고 손실을 방지하기 위한 것입니다.
- **1계층 장비에는 주소의 개념이 없으므로 전기 신호가 들어온 포트를 제외하고 모든 포트에 같은 전기 신호를 전송한다.**
    - 물리 계층 장비에는 주소 개념이 없습니다. 이는 **데이터를 특정 주소로 전송하지 않고, 입력된 포트를 제외한 모든 포트에 동일한 전기 신호를 전송한다는 의미**입니다. 예를 들어, 허브는 데이터가 들어온 포트를 제외한 다른 모든 포트로 신호를 뿌려줍니다. 이러한 방식은 데이터를 특정한 장치로 보내기 위한 지능적인 처리 없이 단순히 연결된 모든 장치에 신호를 전달합니다.
    - 따라서 **물리 계층은 모든 연결된 장치로 데이터를 전송하고, 상위 계층이 이러한 데이터를 적절한 장치로 라우팅하고 주소를 해석하여 최종적으로 정확한 수신자에게 전달**합니다. 이 방식은 네트워크의 효율성을 높이고, 데이터 전송을 보다 체계적으로 관리할 수 있도록 돕습니다.

## 1.4.2 2계층(데이터 링크 계층)

- 전기 신호를 모아 우리가 알아볼 수 있는 데이터 형태로 처리한다.
- 1계층과 달리 전기 신호를 정확히 전달하기 보다는 **주소 정보를 정의하고 정확한 주소로 통신이 되도록 하는데 초점이 맞추어져 있다.**
- 2계층은 출발지와 도착지 주소를 확인하고 내게 보낸 것이 맞는지, 내가 처리해야 하는지에 대해 검사한 후 데이터를 처리한다.
- 2계층에는 주소 체계가 생기면서 여러 통신이 한꺼번에 이루어지는 것을 구분하기 위한 기능이 주로 정의된다.
    - 전기 신호를 모아 데이터 형태로 처리하므로 데이터에 대한 에러를 탐지하거나 고치는 역할을 수행할 수 있다.
    - 신뢰할 수 있는 현대의 물리 계층과 달리 과거에는 신뢰할 수 없는 미디어를 이용해 통신하는 경우도 많아 2계층에서 에러를 탐지하고 고치거나 재전송했지만, 이더넷 기반 네트워크 2계층에서는 에러를 탐지하는 역할만 수행한다.
- 주소 체계가 생긴다는 의미는 한 명과 통신하는 것이 아니라 동시에 여러 명과 통신할 수 있다는 것이므로 **무작정 데이터를 던지는 것이 아니라 받는 사람이 현재 데이터를 받을 수 있는지 확인하는 작업을 해야한다.**
    - 이 역할을 플로 컨트롤(Flow Control) 이라고 부른다.
- 2계층에서 동작하는 네트워크 구성 요소는 네트워크 인터페이스 카드(NIC)와 스위치이다.
- 2계층의 가장 중요한 특징은 MAC 주소라는 주소 체계가 있다는 것이다.
    - 2계층에서 동작하는 NIC와 스위치 모두 MAC 주소를 이해할 수 있고 스위치는 MAC 주소를 보고 통신해야 할 포트를 지정해 내보내는 능력이 있다.
- NIC에는 고유 MAC 주소가 있다.
    - 입력되는 전기 신호를 데이터 형태로 만들고, 데이터에서 도착지 MAC 주소를 확인한 후 자신에게 들어오는 전기 신호가 맞는지 확인한다.
    - 자신에게 들어오는 전기 신호가 아니면 버리고, 자신에게 들어오는 전기 신호가 맞으면 이 데이터를 상위 계층에서 처리할 수 있도록 메모리에 적재한다.
- 스위치는 **단말이 어떤 MAC 주소인지, 연결된 포트는 어느 것인지** 주소 습득 과정에서 알 수 있다.
    - 해당 데이터를 기반으로 단말들이 통신할 때 포트를 적절히 필터링하고 정확한 포트로 포워딩해준다.
    - 반면, 1계층 허브는 한 포트에서 전기 신호가 들어오면 전체 포트로 전기 신호를 전달하다 보니 전체 네트워크에서 동시에 오직 하나의 장비만 데이터를 보낼 수 있다.

## 1.4.3 3계층(네트워크 계층)

- IP 주소와 같은 논리적인 주소가 정의된다.
- 데이터 통신을 할 땐 두 가지 주소가 사용되는데, 2계층의 물리적인 MAC 주소와 3계층의 논리적인 IP 주소이다.
    - IP 주소는 사용자가 환경에 맞게 변경해 사용할 수 있고 네트워크 주소 부분과 호스트 주소 부분으로 나뉜다.
    - 3계층을 이해할 수 있는 장비나 단말은 네트워크 주소 정보를 이용해 자신이 속한 네트워크와 원격지 네트워크를 구분할 수 있고, 원격지 네트워크를 가려면 어디로 가야하는지 경로를 지정하는 능력이 있다.
- 3계층에서 동작하는 장비는 라우터이다.
    - 라우터는 3계층에서 정의한 IP 주소를 이해할 수 있다.
    - 라우터는 IP 주소를 사용해 최적의 경로를 찾아주고 해당 경로로 패킷을 전송하는 역할을 한다.

## 1.4.4 4계층(프랜스포트 계층)

- 4계층은 실제로 해당 데이터들이 정상적으로 잘 보내지도록 확인하는 역할을 한다.
- 패킷 네트워크는 데이터를 분할해 패킷에 실어보내다 보니 중간에 패킷이 유실되거나 순서가 바뀌는 경우가 생길 수 있다.
    - 이 문제를 해결하기 위해 패킷이 유실되거나 순서가 바뀌었을 때 바로잡아 주는 역할을 4계층에서 담당한다.
    - 4계층에서 패킷을 분할할 때 패킷 헤더에 보내는 순서와 받는 순서를 적어 통신하므로 패킷이 유실되면 재전송을 요청할 수 있고 순서가 뒤바뀌더라도 바로잡을 수 있다.
    - **패킷에 보내는 순서를 명시한 것이 시퀀스 번호(Sequence Number)**이고 **받는 순서를 나타낸 것이 ACK 번호(Acknowledgement Number)**이다.
    - 장치 내의 많은 애플리케이션을 구분할 수 있도록 포트 번호(Port Number)를 사용해 상위 애플리케이션을 구분한다.
- 4계층에서 동작하는 장비로는 로드 밸런서와 방화벽이 있다.
    - 이 장비들은 4계층에서 볼 수 있는 포트 번호와 시퀀스, ACK 번호 정보를 이용해 부하를 분산하거나 보안 정책을 수립해 패킷을 통과/차단하는 기능을 수행한다.

## 1.4.5 5계층(세션 계층)

- **양 끝단의 응용 프로세스가 연결을 성립하도록 도와주고 연결이 안정적으로 유지되도록 관리하고 작업 완료 후에는 이 연결을 끊는 역할을 한다.**
- 흔히 우리가 부르는 세션을 관리하는 것이 주 역할인 세션 계층은 TCP/IP 세션을 만들고 없애는 책임을 진다.
- 또한, 에러로 중단된 통신에 대한 에러 복구와 재전송도 수행한다.

## 1.4.6 6계층(프레젠테이션 계층)

- 표현 방식이 다른 애플리케이션이나 시스템 간의 통신을 돕기 위해 하나의 통일된 구문 형식으로 변환시키는 기능을 수행한다.
- 일종의 번역기나 변환기 역할을 수행하는 계층이고, 이런 기능은 사용자 시스템의 응용 계층에서 데이터의 형식상 차이를 다루는 부담을 덜어준다.
- MIME 인코딩이나 암호화, 압축, 코드 변환과 같은 동작이 이 계층에서 이루어진다.

## 1.4.7 7계층(애플리케이션 계층)

- 애플리케이션 프로세스를 정의하고 애플리케이션 서비스를 수행한다.
- 네트워크 소프트웨어의 UI 부분이나 사용자 입출력 부분을 정의하는 것이 애플리케이션 계층의 역할이다.
- 대표적인 프로토콜로는 FTP, SMTP, HTTP, TELNET이 있다.

## [참고] 계층별 주요 프로토콜 및 장비

| 계층 | 주요 프로토콜 | 장비 |
| --- | --- | --- |
| 애플리케이션 계층 | HTTP, SMP, SMTP, STUN, TFTP, TELNET | ADC, NGFW, WAF |
| 프레젠테이션 계층 | TLS, AFP, SSH |  |
| 세션 계층 | L2TP, PPTP, NFS, RPC, RTPC, SIP, SSH |  |
| 트랜스포트 계층 | TCP, UDP, SCTP, DCCP, AH, AEP | 로드 밸런서, 방화벽 |
| 네트워크 계층 | ARP, IPv4, IPv6, NAT, IPSec, VRRP, 라우팅 프로토콜 | 라우터, L3 스위치 |
| 데이터 링크 계층 | IEEE 802.2, FDDI | 스위치, 브릿지, 네트워크 카드 |
| 피지컬 계층 | RS-232, RS-449, V.35, S 등의 케이블 | 케이블, 허브, 탭(TAP) |

# 1.5 인캡슐레이션과 디캡슐레이션
- 현대 네트워크는 대부분 패킷 기반 네트워크이다.
    - 패킷 네트워크는 데이터를 패킷이라는 작은 단위로 쪼개 보내는데, 이런 기법으로 하나의 통신이 회선 전체를 점유하지 않고 동시에 여러 단말이 통신하도록 해준다.
    - 데이터를 패킷으로 쪼개고 네트워크를 이용해 목적지로 보내고 받는 쪽에서는 패킷을 다시 큰 데이터 형태로 결합해 사용한다.
- 애플리케이션에서 데이터를 데이터 플로 계층(1-4계층)으로 내려보내면서 패킷에 데이터를 넣을 수 있도록 분할하는 과정을 `인캡슐레이션`이라고 부른다.
    - 네트워크 상황을 고려해 적절한 크기로 데이터를 쪼개고 4계층부터 네트워크 전송을 위한 정보를 헤더에 붙여넣는다.
    - 헤더 정보는 4계층, 3계층, 2계층에서 각각 자신이 필요한 정보를 추가하는데, 이 정보는 우리가 알아볼 수 있는 문자가 아닌 미리 정의된 비트 단위(0 또는 1)로 쓴다.
    - 4계층에서 헤더를 추가하고 3계층으로 내려보내면 다시 3계층에서 필요한 헤더 정보를 추가하고 2계층으로 내려보낸다.
- 반대로 받는 쪽에서는 `디캡슐레이션` 과정을 수행한다.
    - 받은 전기 신호를 데이터 형태로 만들어 2계층으로 올려보낸다.
    - 2계층에서는 송신자가 작성한 2계층 헤더에 포함된 정보를 확인한다.
        - 만약 2계층에 적힌 정보 중 목적지가 자신이 아니라면 자신에게 온 패킷이 아니므로 버리고, 맞다면 3계층으로 올려보낸다.
        - 랜 카드가 해당 역할을 담당한다.
    - 데이터를 상위 계층으로 올려보낼 때 2계층의 헤더 정보는 더 이상 필요없으므로 벗겨내고 올려보낸다.
- 실제로 데이터는 상위 계층에서 데이터 플로 계층으로, 즉 **상위 계층에서 패킷 형태로 하나씩 인캡슐레이션되면서 내려오고 랜 카드에서 전기 형태로 변환되어 목적지로 전달된다.**
    - 해당 전기 신호를 받은 목적지는 데이터 형태로 변환해 상위 계층으로 올려주고, 이 패킷들을 조합해 데이터 형태로 만든다.
- 각 계층에서 인캡슐레이션 과정에서 수행했던 것처럼 현재 계층에서 추가하는 헤더 정보는 받는 상대방이 확인해야 하는 정보이다.
    - 만약 4계층에서 헤더를 추가했다면 그 정보는 받는 쪽의 4계층에서 확인한다.
    - 중간에 적힌 헤더 정보는 받는 계층에서 참고하고 버린다.
- 헤더에는 다음 두 가지 정보가 반드시 포함되어야 한다.
    1. 현재 계층에서 정의하는 정보
    2. 상위 프로토콜 지시자
- 현재 계층에서 정의하는 정보는 앞에서 다루었던 OSI 7계층의 각 계층에서의 목적에 맞는 정보들이 포함된다.
    - 4계층의 목적은 큰 데이터를 잘 분할하고 받는 쪽에서는 잘 조립하는 것이다.
        - 그렇다보니 잘 분할하고 잘 조립하도록 데이터에 순서를 정하고 받은 패킷의 순서가 맞는지, 빠진 패킷은 없는지 점검하는 역할이 중요하며, 이 정보를 헤더에 적는다.
